<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mashreq Outbound Call Controller</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      color: #fff;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-icon svg {
      width: 28px;
      height: 28px;
      fill: white;
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, #fff 0%, #a8dadc 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: #8892b0;
      font-size: 14px;
      margin-top: 8px;
    }

    .card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 32px;
      margin-bottom: 24px;
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-title .icon {
      width: 32px;
      height: 32px;
      background: rgba(233, 69, 96, 0.2);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card-title .icon svg {
      width: 18px;
      height: 18px;
      fill: #e94560;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 600px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: #a8b2d1;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    input, select, textarea {
      width: 100%;
      padding: 14px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: #fff;
      font-size: 15px;
      font-family: inherit;
      transition: all 0.2s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #e94560;
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.1);
    }

    input::placeholder, textarea::placeholder {
      color: #5a6a8a;
    }

    select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%238892b0' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
    }

    select option {
      background: #1a1a2e;
      color: #fff;
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    .context-fields {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .context-field {
      display: grid;
      grid-template-columns: 1fr 2fr auto;
      gap: 12px;
      align-items: center;
    }

    .context-field input {
      margin-bottom: 0;
    }

    .btn-remove {
      width: 40px;
      height: 40px;
      background: rgba(255, 107, 107, 0.1);
      border: 1px solid rgba(255, 107, 107, 0.2);
      border-radius: 10px;
      color: #ff6b6b;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .btn-remove:hover {
      background: rgba(255, 107, 107, 0.2);
    }

    .btn-add {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: rgba(168, 218, 220, 0.1);
      border: 1px solid rgba(168, 218, 220, 0.2);
      border-radius: 10px;
      color: #a8dadc;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 8px;
    }

    .btn-add:hover {
      background: rgba(168, 218, 220, 0.2);
    }

    .btn-call {
      width: 100%;
      padding: 18px 32px;
      background: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);
      border: none;
      border-radius: 14px;
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 20px rgba(233, 69, 96, 0.3);
    }

    .btn-call:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(233, 69, 96, 0.4);
    }

    .btn-call:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-call svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .result {
      margin-top: 24px;
      padding: 20px;
      border-radius: 14px;
      display: none;
    }

    .result.success {
      display: block;
      background: rgba(46, 213, 115, 0.1);
      border: 1px solid rgba(46, 213, 115, 0.2);
    }

    .result.error {
      display: block;
      background: rgba(255, 107, 107, 0.1);
      border: 1px solid rgba(255, 107, 107, 0.2);
    }

    .result-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
      font-weight: 600;
    }

    .result.success .result-header {
      color: #2ed573;
    }

    .result.error .result-header {
      color: #ff6b6b;
    }

    .result-body {
      font-size: 14px;
      color: #a8b2d1;
      line-height: 1.6;
    }

    .result-body code {
      display: block;
      background: rgba(0, 0, 0, 0.2);
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
      overflow-x: auto;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 12px;
    }

    .caller-info {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      margin-bottom: 24px;
    }

    .caller-info .icon {
      width: 40px;
      height: 40px;
      background: rgba(168, 218, 220, 0.1);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .caller-info .icon svg {
      width: 20px;
      height: 20px;
      fill: #a8dadc;
    }

    .caller-info .details {
      flex: 1;
    }

    .caller-info .label {
      font-size: 12px;
      color: #8892b0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .caller-info .number {
      font-size: 16px;
      font-weight: 600;
      color: #a8dadc;
    }

    .presets {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .preset-btn {
      padding: 8px 14px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: #a8b2d1;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .preset-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.2);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">
        <div class="logo-icon">
          <svg viewBox="0 0 24 24"><path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"/></svg>
        </div>
        <div>
          <h1>Mashreq Outbound Calls</h1>
          <p class="subtitle">AI Voice Agent Controller</p>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">
        <div class="icon">
          <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
        </div>
        Customer Information
      </div>

      <div class="caller-info">
        <div class="icon">
          <svg viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
        </div>
        <div class="details">
          <div class="label">Calling From</div>
          <div class="number">+1 585 667 8990</div>
        </div>
      </div>

      <form id="callForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="phoneNumber">Phone Number *</label>
            <input type="tel" id="phoneNumber" name="phoneNumber" placeholder="+971..." required>
          </div>

          <div class="form-group">
            <label for="fullName">Full Name *</label>
            <input type="text" id="fullName" name="fullName" placeholder="Customer name" required>
          </div>

          <div class="form-group">
            <label for="preferredLanguage">Preferred Language *</label>
            <select id="preferredLanguage" name="preferredLanguage" required>
              <option value="English">English</option>
              <option value="UAE Arabic">UAE Arabic</option>
              <option value="Egyptian Arabic">Egyptian Arabic</option>
              <option value="Hindi">Hindi</option>
            </select>
          </div>

          <div class="form-group">
            <label for="callReason">Call Reason *</label>
            <input type="text" id="callReason" name="callReason" placeholder="e.g., Complaint Resolution Update" required>
          </div>
        </div>

        <div class="presets">
          <button type="button" class="preset-btn" data-preset="complaint">Complaint Update</button>
          <button type="button" class="preset-btn" data-preset="rewards">Rewards Reminder</button>
          <button type="button" class="preset-btn" data-preset="account">Account Update</button>
          <button type="button" class="preset-btn" data-preset="followup">Follow-up Call</button>
        </div>
      </form>
    </div>

    <div class="card">
      <div class="card-title">
        <div class="icon">
          <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
        </div>
        Context Data
      </div>

      <p style="color: #8892b0; font-size: 14px; margin-bottom: 20px;">
        Add key-value pairs that the AI agent should know about this customer.
      </p>

      <div class="context-fields" id="contextFields">
        <div class="context-field">
          <input type="text" placeholder="Key (e.g., complaintStatus)" class="context-key">
          <input type="text" placeholder="Value (e.g., Resolved)" class="context-value">
          <button type="button" class="btn-remove" onclick="removeContextField(this)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
          </button>
        </div>
      </div>

      <button type="button" class="btn-add" onclick="addContextField()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
        Add Field
      </button>
    </div>

    <button type="submit" class="btn-call" id="callBtn" onclick="initiateCall()">
      <svg viewBox="0 0 24 24"><path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"/></svg>
      Initiate Outbound Call
    </button>

    <div class="result" id="result">
      <div class="result-header">
        <span id="resultIcon"></span>
        <span id="resultTitle"></span>
      </div>
      <div class="result-body" id="resultBody"></div>
    </div>
  </div>

  <script>
    // Preset configurations
    const presets = {
      complaint: {
        callReason: 'Complaint Resolution Update',
        context: [
          { key: 'complaintStatus', value: 'Resolved' },
          { key: 'resolutionDate', value: new Date().toISOString().split('T')[0] },
          { key: 'resolutionSummary', value: '' }
        ]
      },
      rewards: {
        callReason: 'Rewards Points Expiry Reminder',
        context: [
          { key: 'pointsBalance', value: '' },
          { key: 'expiryDate', value: '' },
          { key: 'redemptionOptions', value: 'Travel vouchers, cashback, or gift cards' }
        ]
      },
      account: {
        callReason: 'Account Update Confirmation',
        context: [
          { key: 'updateType', value: '' },
          { key: 'updateDate', value: new Date().toISOString().split('T')[0] },
          { key: 'updatedFields', value: '' }
        ]
      },
      followup: {
        callReason: 'Service Follow-up',
        context: [
          { key: 'previousInteraction', value: '' },
          { key: 'followupReason', value: '' }
        ]
      }
    };

    // Handle preset buttons
    document.querySelectorAll('.preset-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const preset = presets[btn.dataset.preset];
        if (preset) {
          document.getElementById('callReason').value = preset.callReason;
          
          // Clear existing context fields
          const container = document.getElementById('contextFields');
          container.innerHTML = '';
          
          // Add preset context fields
          preset.context.forEach(({ key, value }) => {
            addContextField(key, value);
          });
        }
      });
    });

    function addContextField(key = '', value = '') {
      const container = document.getElementById('contextFields');
      const field = document.createElement('div');
      field.className = 'context-field';
      field.innerHTML = `
        <input type="text" placeholder="Key (e.g., complaintStatus)" class="context-key" value="${key}">
        <input type="text" placeholder="Value (e.g., Resolved)" class="context-value" value="${value}">
        <button type="button" class="btn-remove" onclick="removeContextField(this)">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      `;
      container.appendChild(field);
    }

    function removeContextField(btn) {
      const container = document.getElementById('contextFields');
      if (container.children.length > 1) {
        btn.parentElement.remove();
      } else {
        // Clear the last field instead of removing it
        const field = btn.parentElement;
        field.querySelector('.context-key').value = '';
        field.querySelector('.context-value').value = '';
      }
    }

    function getContextData() {
      const fields = document.querySelectorAll('.context-field');
      const data = {};
      fields.forEach(field => {
        const key = field.querySelector('.context-key').value.trim();
        const value = field.querySelector('.context-value').value.trim();
        if (key && value) {
          data[key] = value;
        }
      });
      return data;
    }

    function showResult(success, title, body) {
      const result = document.getElementById('result');
      const resultIcon = document.getElementById('resultIcon');
      const resultTitle = document.getElementById('resultTitle');
      const resultBody = document.getElementById('resultBody');

      result.className = 'result ' + (success ? 'success' : 'error');
      resultIcon.innerHTML = success 
        ? '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>'
        : '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>';
      resultTitle.textContent = title;
      resultBody.innerHTML = body;
    }

    async function initiateCall() {
      const btn = document.getElementById('callBtn');
      const phoneNumber = document.getElementById('phoneNumber').value.trim();
      const fullName = document.getElementById('fullName').value.trim();
      const preferredLanguage = document.getElementById('preferredLanguage').value;
      const callReason = document.getElementById('callReason').value.trim();
      const contextData = getContextData();

      // Validation
      if (!phoneNumber || !fullName || !callReason) {
        showResult(false, 'Validation Error', 'Please fill in all required fields.');
        return;
      }

      if (!phoneNumber.startsWith('+')) {
        showResult(false, 'Validation Error', 'Phone number must start with + (E.164 format)');
        return;
      }

      // Show loading state
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div> Initiating Call...';

      try {
        const response = await fetch('/api/outbound-call', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            phoneNumber,
            fullName,
            preferredLanguage,
            callReason,
            contextData
          })
        });

        const data = await response.json();

        if (data.success) {
          showResult(true, 'Call Initiated Successfully', `
            <p>The AI agent is now calling <strong>${fullName}</strong> at <strong>${phoneNumber}</strong>.</p>
            <p>Call Reason: ${callReason}</p>
            <code>${JSON.stringify(data.data, null, 2)}</code>
          `);
        } else {
          showResult(false, 'Call Failed', `
            <p>${data.message || data.error}</p>
            ${data.details ? '<p>' + data.details.join('<br>') + '</p>' : ''}
          `);
        }
      } catch (error) {
        showResult(false, 'Error', `<p>Failed to connect to the server: ${error.message}</p>`);
      } finally {
        btn.disabled = false;
        btn.innerHTML = `
          <svg viewBox="0 0 24 24"><path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"/></svg>
          Initiate Outbound Call
        `;
      }
    }

    // Allow Enter key to submit
    document.getElementById('callForm').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        initiateCall();
      }
    });
  </script>
</body>
</html>
